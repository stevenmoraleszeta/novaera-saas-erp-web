Objective:
This module enables administrators and authorized users to manage system users, including viewing, creating, editing, deactivating, and inspecting user details. It integrates with backend APIs using JWT authentication (stored in HTTP-only cookies) and enforces role-based access control.

Submodules & Key Features:
Submodule 2.1: User Listing & Main View
Components:

UsersTable: Displays users in a paginated, sortable, and filterable table.

UserStatusBadge: Visual indicator (active/inactive) with toggle functionality.

SearchBar: Filters users by name, email, or role.

Pagination: Controls data chunking for large datasets.

Functionality:

Fetches users via fetchUsers() (API call to backend).

Supports bulk actions (e.g., multi-select deactivation).

Links to detailed user views.

Submodule 2.2: Custom Hook (useUsers)
Methods:

fetchUsers(): Retrieves all users (supports pagination/filters).

getUserById(id): Fetches a single user’s details.

createUser(data): Submits new user data to the backend.

updateUser(id, data): Edits existing user records.

toggleUserState(id): Activates/deactivates a user.

Dependencies:

Uses useAxiosAuth for authenticated API calls.

Integrates with useNotification for success/error feedback.

Submodule 2.3: User Creation/Edit Form
Fields:

Name, email, password (hidden in edit mode), role (dynamic dropdown), and status (edit only).

Components:

UserForm: Reusable for both create/edit modes.

FormInput: Validates inputs (required fields, email format).

SelectInput: Fetches roles via fetchRoles() (backend API).

Validation:

Frontend checks (e.g., password strength, unique email).

Backend validation via API responses.

Submodule 2.4: User Detail View
Displays:

Name, email, role, creation date, last login, and status.

Actions:

Edit/delete buttons (conditionally rendered based on permissions).

Submodule 2.5: Status Toggle & Confirmation
Workflow:

Toggle triggers a confirmation modal (useModal hook).

Updates UI optimistically; reverts on API failure.

Notifies user via useNotification.

Submodule 2.6: Role Integration
Dynamic Role Fetching:

fetchRoles() populates dropdowns in forms.

Roles cached to minimize API calls.

Submodule 2.7: Security & Permissions
Access Control:

Middleware validates JWT before rendering routes.

UI elements (e.g., "Create User" button) hidden for unauthorized roles.

Backend Checks:

API endpoints enforce role-based permissions (e.g., only admins can edit roles).

Submodule 2.8: Additional Hooks & Utilities
useAuth: Checks user permissions before actions.

useNotification: Displays alerts for CRUD operations.

useModal: Manages confirmation dialogs (e.g., for deletions).

Technical Stack:
State Management: React Context (AuthContext) + hooks.

API: Axios with JWT auto-injection (via cookies).

UI: Reusable components (e.g., tables, forms) with SCSS/CSS modules.

Routing: Next.js App Router with protected routes (middleware).

Backend Integration:
Endpoints:

GET /users: Fetch users.

POST /users: Create user.

PUT /users/:id: Update user.

PATCH /users/:id/status: Toggle status.

Procedures:

sp_obtener_usuarios, sp_crear_usuario, etc.

User Flow:
Admin logs in → Accesses user list → Filters/searches → Edits a user.

Manager (limited permissions) → Views users but cannot edit roles.

Note for Agent:
This module is highly interactive, with real-time validation, role-based UI rendering, and seamless API integration. Ensure responses align with the ERP’s security model (JWT/cookies, backend checks). Prioritize reusable hooks/components for scalability.

# Basic DB structure
--CREATE DATABASE ERPSystem
-- Tabla de módulos
CREATE TABLE "modules" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" VARCHAR(100) NOT NULL,
  "description" TEXT,
  "icon_url" TEXT,
  "created_by" INT,
  "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de tablas (entidades relacionadas a un módulo)
CREATE TABLE "tables" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "module_id" INT NOT NULL,
  "name" VARCHAR(100) NOT NULL,
  "description" TEXT,
  "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de columnas
CREATE TABLE "columns" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "table_id" INT NOT NULL,
  "name" VARCHAR(100) NOT NULL,
  "data_type" VARCHAR(50) NOT NULL,
  "is_required" BOOLEAN DEFAULT false,
  "is_foreign_key" BOOLEAN DEFAULT false,
  "foreign_table_id" INT,
  "foreign_column_name" VARCHAR(100),
  "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de registros (data en formato JSON)
CREATE TABLE "records" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "table_id" INT NOT NULL,
  "record_data" JSONB NOT NULL,
  "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de usuarios
CREATE TABLE "users" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" VARCHAR(100) NOT NULL,
  "email" VARCHAR(100) UNIQUE NOT NULL,
  "password_hash" TEXT NOT NULL,
  "is_active" BOOLEAN DEFAULT true,
  "is_blocked" BOOLEAN DEFAULT false,
  "last_login" TIMESTAMP,
  "avatar_url" TEXT
);

-- Historial de inicios de sesión
CREATE TABLE "user_login_history" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" INT NOT NULL,
  "login_time" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  "ip_address" TEXT,
  "user_agent" TEXT
);

-- Tabla de roles
CREATE TABLE "roles" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" VARCHAR(50) NOT NULL
);

-- Tabla intermedia entre usuarios y roles (muchos a muchos)
CREATE TABLE "user_roles" (
  "user_id" INT NOT NULL,
  "role_id" INT NOT NULL,
  PRIMARY KEY ("user_id", "role_id")
);

-- Tabla de permisos
CREATE TABLE "permissions" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "table_id" INT NOT NULL,
  "role_id" INT NOT NULL,
  "can_create" BOOLEAN DEFAULT false,
  "can_read" BOOLEAN DEFAULT false,
  "can_update" BOOLEAN DEFAULT false,
  "can_delete" BOOLEAN DEFAULT false
);

-- Notificaciones
CREATE TABLE "notifications" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" INT NOT NULL,
  "title" VARCHAR(100) NOT NULL,
  "message" TEXT,
  "read" BOOLEAN DEFAULT false,
  "link_to_module" TEXT,
  "created_at" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Comentarios
COMMENT ON COLUMN "modules"."icon_url" IS 'URL del ícono del módulo (Firebase Storage)';
COMMENT ON COLUMN "users"."is_active" IS 'Indica si el usuario está habilitado';
COMMENT ON COLUMN "users"."is_blocked" IS 'Indica si el usuario está bloqueado';
COMMENT ON COLUMN "users"."last_login" IS 'Fecha del último inicio de sesión';
COMMENT ON COLUMN "users"."avatar_url" IS 'URL del avatar o foto de perfil';
COMMENT ON COLUMN "user_login_history"."login_time" IS 'Fecha y hora del login';
COMMENT ON TABLE "user_roles" IS 'Tabla intermedia con PK compuesta usuario-rol';

-- Llaves foráneas
ALTER TABLE "modules" ADD FOREIGN KEY ("created_by") REFERENCES "users" ("id") ON DELETE SET NULL;
ALTER TABLE "tables" ADD FOREIGN KEY ("module_id") REFERENCES "modules" ("id") ON DELETE CASCADE;
ALTER TABLE "columns" ADD FOREIGN KEY ("table_id") REFERENCES "tables" ("id") ON DELETE CASCADE;
ALTER TABLE "columns" ADD FOREIGN KEY ("foreign_table_id") REFERENCES "tables" ("id") ON DELETE SET NULL;
ALTER TABLE "records" ADD FOREIGN KEY ("table_id") REFERENCES "tables" ("id") ON DELETE CASCADE;
ALTER TABLE "user_login_history" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE CASCADE;
ALTER TABLE "user_roles" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE CASCADE;
ALTER TABLE "user_roles" ADD FOREIGN KEY ("role_id") REFERENCES "roles" ("id") ON DELETE CASCADE;
ALTER TABLE "permissions" ADD FOREIGN KEY ("table_id") REFERENCES "tables" ("id") ON DELETE CASCADE;
ALTER TABLE "permissions" ADD FOREIGN KEY ("role_id") REFERENCES "roles" ("id") ON DELETE CASCADE;
ALTER TABLE "notifications" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE CASCADE;
